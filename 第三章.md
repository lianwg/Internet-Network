## 第三章

- 链路层
    - 数据链路层基础概述
        - *数据链路层概念*
            - 是物理层和网络层之间的协议，提供相邻结点的可靠数据传输
        - 帧的概念
            - 数据链路层的协议**数据单元**
            - 组成
                - ![](/Users/86191/AppData/Local/Temp/95644fd4-4c30-4a04-b23e-a661f34a1bb2.png)
                - 帧头
                    - 源MAC、目的MAC、类型
                        - MAC地址：48位
                - 数据
                - 帧尾
                    - 校验
        - *以太网数据帧中的MAC协议和LLC协议（IEEE 802.3）*
            - 将数据链路层协议划分为上层的LLC协议和下层的MAC协议
            - 以太网：总线型的局域网
                - ![](/Users/86191/AppData/Local/Temp/ea9141cd-20eb-4f56-aaf9-0a33b0813215.png)上面是最初的以太网，下面的是修订后的以太网，是主流，所以802.3局域网也叫做以太网
            - MAC（Multiple Access Control协议，对接物理层）
                - 信道划分介质访问控制协议
                    - MAC协议决定了节点什么时候允许发送分组，而且通常控制对物理层的所有访问。
                    - 作用：数据帧的封装/卸载，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同物理链路层种类的差异性。
            - LLC（对接链路层）
                - LLC逻辑控制访问
                - 作用：传输可靠性保障和控制，数据包的分段与重组。数据包的顺序传播。
            - 注意：
                - 该协议位于OSI七层协议中数据链路层，数据链路层分为上层LLC（逻辑链路控制），和下层的MAC（媒体访问控制），MAC主要负责控制与链接物理层的物理介质。在发送数据的时候，MAC协议可以事先判断是否发送数据，如果可以发送将给数据加上一些控制信息，最终将数据以及控制信息以规定的格式发送到物理层；在接收数据的时候，MAC协议首先判断输入的信息并是否发生传输错误，如果没有错误，则去掉控制信息发送至LLC（逻辑链路控制）层。
        - 数据链路层的两种传输方式
            - 单播
            - 广播
        - *数据链路层的三个基本问题*
            - 封装成帧
                - **封装成帧就是在一段数据的前后分别添加首部和尾部**，这样就构成了一个帧，接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中**识别帧的开始和结束**帧同步
                - 接收方应当能从接收的二进制比特流中区分帧的起始和终止
                - 组帧的四种方法
                    - 1.字符技术法
                        - 帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数
                            - 缺点：当有一个字节出现错误，就会导致后面的字节全部出现错误。
                    - 2.字符（节）填充法
                        - 当数据出现SOH时，会判断出当前为数据开始字节，用EOT代表数据结束字节
                        - 当中间部分有部分字节和SOH、EOT重复时，会在该字节之前加上**ESC（转义字符）**来告诉接收方当前字节无须作判断，直接接收即可。即当接收到ESC时，会删除ESC转义字符，然后直接接收后面的字节
                    - 3.零比特填充法
                        - 01111110作为起始和结尾
                        - 在发送端，扫描整个数据字段，只要连续5个1，在后面填1个0
                        - 在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描，发现连续5个1就删掉后面的1个0，得到原始字段
                    - 4.违规编码法
                        - 因为曼彻斯特编码是高-低（1），或低-高（0）显示的编码，因此可以使用高-高，低-低（违规编码）来定界帧的起始和终止
                    - 由于字节计数法中Count字段的脆弱性（其值若有差错将导致灾难性后果）及字符填充实现上的复杂性和不兼容性，目前较普遍使用的帧同步法是比特填充和违规编码法。
            - 透明传输
                - 透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传输，而不会引起对帧边界的判断错误
                - 字符（节）填充法、零比特填充法...其他？
            - 差错检测
                - 收到正确的帧就要向发送端发送确认，发送端在一定的期限内若没有收到对方的确认，就认为出现了差错，因而就进行**重传**，直到收到对方的确认为止
                    - 奇偶校验
                        - 奇数校验：数据位上1的个数个校验位上1的个数之和为奇数
                        - 偶数校验数据位上1的个数个校验位上1的个数之和为偶数
                        - 单比特位偶校验：当有偶数个bit为发送错误的时候，这种方式无法检测，准确率不高
                        - 二位偶校验：可以检测也可以纠错（二维精确定位出错bit位）
                    - CRC
                        - 可以纠错
        - 局域网中的设备
            - 集线器Hub
                - 集线器的主要功能是对接受的信号进行再生整形放大，以扩大网络的传输距离，同时把所有的结点集中在以它为中心的结点上
                - 共享带宽
                - 物理层
            - 交换机Switch
                - 是一种用于电（光）信号转发的网络设备。可以为接入交换机的任意两个网络结点提供独享的电信号通路。以太网交换机是最常见的交换机。
                - 独享带宽
                - 链路层
            - 网桥
                - 两个端口的交换机
                - 物理层与链路层之间
                - 划分为两个冲突域

## 数据链路层的通信协议

- *媒介访问控制*：介质访问控制协议（MAC Multiple Access Control）
    - 采取一定措施，使得两队节点之间的通信不会发生互相干扰
        - 静态划分信道：
            - 信道划分介质访问控制协议：基于多路复用技术划分资源
                - 网络负载重：共享信道效率高，且公平
                    - 网络负载轻：共享信道效率低
                - 多路复用技术
                    - 把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率
                - 信道划分介质访问控制：将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把时域和频域资源合理地分配给网络上的设备
                    - 频分多路复用FDM
                        - 用户在分配到一定的频带后，在通信过程中自始自终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽（频率带宽）资源。**“并行”**
                    - 时分多路复用TDM
                        - 将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道。**“并发”**
                        - 改进的时分复用--统计时分复用STDM（按需动态分配时隙）
                    - 波分多路复用WDM
                        - 波分多路复用就是光的频分多路复用，在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率）不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来
                    - 码分多路复用CDM
                        - 码分多址（CDMA）是一种码分复用的一种方式。
                        - 1比特分为多个码片/芯片（chip），每一个站点被指定一个唯一的m位芯片序列。发送1时站点发送芯片序列，发送0时，发送芯片序列反码（通常把0写成-1）。
                        - 如何不打架：多个结点同时发送数据的时候，要求各个结点芯片序列相互正交。
                        - 如何合并：各路数据在信道中被线性相加。
                        - 如何分离：合并的数据和源站规格化内积。
        - 动态分配信道
            - 轮询访问介质访问控制：轮询访问MAC协议/轮流协议/轮转访问MAC协议
                - 既要不产生冲突，又要发送全部带宽
                - 轮询协议
                    - 思想：主结点轮流“邀请”从属结点发送数据
                    - 问题：1.轮询开销 2.等待延迟 3.单点故障
                - 令牌环协议
                    - 令牌：一个特殊格式的MAC控制帧，不含任何信息。控制信道的使用，确保同一时刻只有一个结点独占信道。令牌环网中无碰撞
                    - 每个结点都可以在一定时间内（令牌持有时间）获得发送数据的权利，并不是无限制地持有令牌。
                    - 问题：1.令牌开销 2.等待延迟 3.单点故障
                    - 应用：应用于令牌环网（物理星型拓扑，逻辑环形拓扑）。采用令牌传递方式的网络常用于**负载较重、通信量较大**的网络中。
            - **随机访问介质访问控制**：随机访问MAC协议
                - 用户根据意愿随机发送信息，发送信息时可独占信道带宽
                    - 网络负载重：产生冲突开销
                    - 网络负载轻：共享信道效率高，单个节点可利用信道全部带宽
                - ALOHA协议
                    - 思想：不监听信道，不按时间槽发送，随机发送。想发就发。
                    - 冲突检测：如果发生冲突，接收方就会检测出差错，然后**不予确定**，发送方在一定时间内收不到就判断发生冲突
                    - 冲突解决：超时后等一随机时间在重传
                - 时隙(Slotted)ALOHA协议
                    - **控制想发就发的随意性**：把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送
                - *CSMA协议*
                    - 载波监听多路访问协议（carrier sense multiple access）
                    - CS：载波侦听/监听，每一个站在**发送数据之前**要检测一下总线上是否有其他计算机在发送数据
                    - MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上
                    - 思想：发送帧之前，监听信道
                        - 监听结果
                            - 监听到信道空闲：发送完整帧
                            - 监听到信道忙：推迟发送
                        - 1-坚持CSMA
                            - 信道空闲：马上发；信道忙：继续监听，空闲就发；遇到冲突就随机等待再监听
                            - 优点：避免媒体利用率损失；缺点：冲突不可避免
                        - （0-）非坚持CSMA
                            - 信道空闲：马上发；信道忙：随即等待再监听
                            - 优点：采用随机的重发延迟时间减少冲突发生率；存在信道空闲，媒体利用率低
                        - p-坚持CSMA
                            - 信道空闲：以p概率传输，不传则等到下一个时间槽；信道忙：继续监听直到空闲
                                - 优点：既能减少冲突，又减少媒体空闲时间；缺点：如果发生冲突会坚持把数据发送完，造成浪费
                    - 冲突检测：当几个站同时在总线上发送数据时，总线上的**信号电压摆动值**将会增大（互相叠加）。当一个站检测到的信号电压摆动值超过一定门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，即发生了冲突
                - CSMA/CD协议：*以太网*
                    - 载波监听多点接入/碰撞检测
                    - CD：碰撞检测（冲突检测），**边发送边监听**，适配器边发送数据边检测信道上信号电压的变化情况，以判断是否有其他结点在发送数据（即是否产生冲突）
                    - 传播时延对载波监听的影响
                        - ![](4a60a6ec-266c-4d04-b3f3-0f26ac2b99b3_1.webp)
                        - **争用期/冲突窗口/碰撞窗口=总线端到端的往返时延：2r**
                    - *截断二进制指数规避算法*
                        - 用于确定碰撞后的重传时间
                        - 1.基本退避（推迟）时间为争用期2r
                            - 以太网争用期为51.2us
                        - 2.定义参数k，它等于重传次数，但k不超过10，即k=min[重传次数，10]。当重传次数不超过10时，k等于重传次数；当重传次数大于10时，k就不再增大而一直等于10
                        - 3.从离散的整数集合[0, 1, ..., 2^k-1]中随机取出一个数m，重传所需要退避的时间就是r倍的基本退避时间，即2r`*`m
                        - 4,**当重传达16次仍不能成功时**，说明网络太拥挤，认为此帧永远无法正确发出，**抛弃此帧并向高层报告出错**
                    - 最小帧长问题
                        - 保证了站点在帧在发送过程中，能够检测到帧是否发生了碰撞
                        - 帧的**传输时延**至少要两倍于信号在总线中的**传播时延**
                        - ![](fcf9104c-8601-44dd-a9c5-5720a69d3939_1.webp)
                        - *最小帧长*=2x总线传播时延x数据传输速率
                            - 以太网规定最小帧长64字节
                    - 最大帧长问题
                        - 如果一个帧的长度过大，一个站点不停地发送帧，让其他站点一直无法无法使用信道；如果帧的长度过大，接收方的缓冲区可能也装不下该帧产生溢出
                        - 以太网规定是1518字节
                - CSMA/CA协议：*无线局域网*
                    - 载波监听多点接入/碰撞
                    - 为什么要有CSMA/CA？
                        - 无线局域网
                            - 无法做到全面检测碰撞
                        - 隐蔽站
                            - 当A和C都检测不到信号，认为信道空闲时，同时向终端B发送数据帧，就会导致冲突
                    - 思想：**发送数据前，先检测信道是否空闲**。空闲则发出RTS（request to send），RTS包括发射端的地址、接收端的地址、下一份数据持续发送的时间等信息；信道忙则等待。接收端收到RTS后，将响应CTS（clear to send）。**发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）**。接收端收到数据帧后，将用CRC来检验数据是否正确，正确则响应ACK帧。**发送方收到ACK就可以进行下一个数据帧的发送**，若没有则一直重传至规定重发次数为止（采用二进制指数退避算法来确定随机的推迟时间）
                        - 1.预约信道
                        - 2.ACK帧
                        - 3.RTS/CTS帧（可选，主要解决隐蔽站问题）
                - CSMA/CA与CSMA/CD相比较
                    - 相同点：都属于CSMA思路，其核心是先听再说；二者出现冲突后都进行有上限重传
                    - 不同点：
                        - 1.传输介质不同：CSMA/CD用于总线式以太网【有线】，而CSMA/CA用于无线局域网【无线】
                        - 2，载波检测方式不同：因传输介质不同，检测方式也不同。CSMA/CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随着发生变化；而CSMA.CA采用能量检测（ED）、载波监听（CS）和能量载波混合检测三种检测信道空闲的方式
                        - 3，CSMA/CD检测冲突，CSMA/CA避免冲突

## 局域网基本概念和体系结构

- 局域网（LAN）：指在某一区域内有多台计算机互联成的计算机组，使用广播信道。**决定局域网的主要要素为：网络拓扑，传输介质与介质访问控制方法**
    - 特点
        - 1.覆盖地理范围较小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内
        - 2.使用专门铺设的**传输介质（双绞线、同轴电缆）进行联网**，数据传输速率高（10Mb/s~10Gb/s）
        - 3，通信延迟时间短，误码率低，可靠性较高
        - 4.各站为平等关系，共享传输信道
        - 5.多采用分布式控制和广播式通信，能进行广播和组播
    - 四种拓扑结构
        - ![](6bc94df8-04a0-475b-80f1-01ba429892bd_1.webp)
    - 介质访问控制方法
        - 1.CSMA/CD：常用于总线型局域网，也用于树型网络
        - 2.令牌总线：常用于总线型局域网，也用于树型网络
        - 3.令牌环：用于环形局域网，如令牌环网
    - 网桥
        - ![](daf949ca-e696-4b6e-9c53-3b83c7825599_1.webp)网段A和网段B如果是同构网是可以直接用电缆相连，但是如果是不同种类的网络，比如以太网和令牌环网不能直接用介质相连，这时候需要中转设备（网桥）进行相连。网桥只有若干个端口，因此一般直接相连的是网段，而不是主机
        - 作用：工作在数据链路层的一种网络互连设备，**在互连的LAN之间实现帧的存储和转发**；可以**连接不同类型的局域网**；根据MAC帧的目的地址对收到的帧进行**转发**；网桥具有**过滤帧**的功能，当网桥收到一个帧时，并不是向所有的端口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个端口
        - 工作流程
            - 1.从某个端口收到的二层报文，解析二层报文的源MAC和目的MAC
            - 2.根据源MAC学习形成MAC表
            - 3.根据目的MAC，**原封不动的**将该报文转发到**适当的**出端口，从而保证最终目的设备能收到这个报文。这个转发过程有两个关键：
                - a.**原封不动的：** 所谓原封不动，*就是交换机不会修改报文内容，包括报文的源MAC，目的MAC（这一点与路由器形成区别，路由器工作在三层，在转发过程中每一跳都会修改源MAC和目的MAC）*
                - b,**适当的：**交换机要以尽可能小的代价确保报文最终能安全可靠的到达目的地。
                    - **已知单播 - 单播**:对于单播报文，如果知道目的地址在哪个端口（MAC表中能找到该目的MAC），就从该端口转发出去
                    - **未知单播 - 泛洪**:对于单播报文，如果暂时还不知道目的地址是哪个端口，则从所有非源端口泛洪出去
                    - **组播广播 - 泛洪**：对于广播和组播，也需要泛洪
        - 工作原理：![](8f1b8540-b84b-4b79-81c0-8f6a462a9dbd_1.webp)网桥是不支持VLAN的二层交换机
            - MAC学习：维护MAC表（mac地址到出接口的映射表）
                - 监听学习：当交换机从某个端口收到一个数据包，它先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上的
                - 监听更新：网络拓扑不可能是永不改变的，当发生改变时，会改变映射关系
                - 定时老化：网络拓扑变化还有一种可能性，就是直接将机器C拔掉了，这种情况下怎么保证mac表的正确性呢。很简单，如果一定时间内该端口没有收到C的任何报文，则假设该主机以及离线，将改主机对应的mac表象老化删除。 （假如该主机还在，只是这段时间没有发送报文怎么办？ 想想，其实没有关系，大不了再次泛洪，重新学习）
            - 转发环路：转发环路的问题，*通常需要通过STP等信令协议进行破环。通过STP对某些链路进行剪枝操作，故意让某些链路停止工作，从而将物理上的有环网络（离散数学中的图），转变为逻辑上的无环网络（离散数学中的树）*
                - 生成树算法：就是把一个环形的结构改变成一个树形的结构。STP协议就是用来讲物理上存在环路的网络，通过一种算法，**在逻辑上阻塞一些端口，来生成一个逻辑上的树形结构**
                    - 逻辑上断开环路，防止广播风暴
                    - 当线路故障，阻塞接口激活恢复通信，起备份线路作用
                    - 生成树算法
                        - 1.选择根网桥（boot bridge）
                            - 按照生成树算法的定义：交换机网桥ID值最小，**优先级小**的被选择为根网桥；优先级相同情况下，**MAC地址小**的为根网桥
                            - 网桥ID值：网桥ID是一个8字节的字段，前2字节的十进制数成为网桥优先级，后6字节是网桥的MAC地址。网桥优先级的默认值是32768，取值范围是0~65535。**网桥ID中的MAC地址是交换机自身的MAC地址**
                        - 2.选择根端口（root ports）
                            - 根端口存在于非根网桥上，需要在**每个非根网桥上**选择一个根端口
                            - 选择根端口时，顺序如下：a、到根网桥最低的根路径成本（带宽越大路径成本越小） b、直连的网桥ID最小 c、 端口ID最小（注：比较的是接收到的对端的端口ID值）
                            - 端口ID是一个2字节的STP参数，由1字节端口优先级和1字节端口编号组成。优先级的默认值是128，取值范围是0~255。**端口编号不是端口号**，但是端口号低的端口，端口编号也小
                        - 3.选择指定端口（designated ports）
                            - 为了消除环路形成的可能，STP进行最后的计算，在**每一个网段上**选择一个指定端口
                            - 选择指定端口顺序如下：a、 根路径成本较低； b、所在的交换机的网桥ID值较小； c、  端口ID值较小（比较的是自身的端口ID值）
                    - 桥协议数据单元（BPDU）
                        - 交换机之间通过BPDU（桥协议数据单元）来交换网桥ID、根路径成本等信息。BPDU帧利用了一个STP组播地址（01-80-c2-00-00-00）作为它的一个目的地址，使之能到达相邻的、并处于STP侦听状态的交换机。BPDU报文每隔2S向所有的交换机端口发送一次报文，以便交换机能交换当前最新的拓扑信息，并迅速识别和检测其中的环路。
                        - 类型：配置BPDU，用于生成树计算；拓扑变更通告（topology change notification，TCN），BPDU用于通告网络拓扑的变化
                        - 报文字段：BPDU中包含根网桥ID、根路径成本、发送网桥ID、端口ID和计时器等，对BPDU几个关键字段作用的解释如下：
                            - 根网桥ID：有一个2字节优先级和一个6字节网桥MAC地址组成。这个信息组合表明已经被选定为根网桥的设备标识
                            - 根路径成本：说明这个BPDU从根网桥传输了多远、成本是多少。这个字段的值决定哪些端口进行转发，哪些端口将被阻断
                            - 发送网桥ID：这是发送该BPDU网桥信息，由网桥的优先级和网桥的MAC地址组成
                            - 端口ID：由一字节的端口优先级和一字节的端口编号组成
                            - 计时器：用于说明生成树用多长时间能完成它的每项功能。这些功能包括报文老化时间、最大老化时间、访问时间和转发延迟
                    - STP利用BPDU选择根网桥的过程
                        - 当一台交换机第一次启动时，假设自己是根网桥，在BPDU报文中的根网桥字段填入自己的网桥ID
                        - 当接收到其他交换机发出的BPDU后，比较网桥ID，选择较小的添加到根网桥ID中
                        - 当全网所有的交换机接收到全部的BPDU并作比较后，就可以选择出唯一的一个根网桥
    - 二三层交换机工作原理
        - 二层交换机：二层交换技术是发展比较成熟， 二层交换机属数据链路层设备，可以识别数据包中的 MAC地址信息， 根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中 
        - 三层交换机：**三层交换技术就是将路由技术与交换技术合二为一的技术**。在对第一个数据流进行路由后，它将会产生一个MAC地址与IP地址的映射表，当同样的数据流再次通过时，将根据此表直接从二层通过而不是再次路由，从而消除了路由器进行路由选择而造成网络的延迟，提高了数据包转发的效率
            - 路由器：路由器工作于OSI七层协议中的第三层，其主要任务是接收来自一个网络接口的数据包，根据其中所含的目的地址，决定转发到下一个目的地址。因此，路由器首先得在转发路由表中查找它的目的地址，若找到了目的地址，就在数据包的帧格前添加下一个MAC地址，同时IP数据包头的TTL（Time To Live）域也开始减数，并重新计算校验和。当数据包被送到输出端口时，它需要按顺序等待，以便被传送到输出链路上
    - 网桥、集线器，二层交换机、三层交换机和路由器的比较：
        - 集线器：工作在物理层，将数据报转发到相应的的物理接口。集线器是一种简单的网络设备，用于将多个计算机连接在一起形成一个局域网。它的主要功能是**将接收到的数据包广播到所有连接的计算机上**，没有任何智能处理。当一个计算机发送数据时，集线器会将数据复制到所有其他端口上，以便所有设备都能接收到。
        - 网桥：工作在数据链路层，基于MAC地址进行数据包的**转发和过滤**。网桥是一种连接两个局域网的设备，它具有学习和过滤数据包的功能。网桥通过学习每个物理接口上的MAC地址，维护一个转发表，从而只将数据包发送到目标MAC地址所在的接口，减少了广播和冲突。
        - 二层交换机：工作在数据链路层，使用MAC地址进行数据包的**转发和选择性过滤**。它可以学习和记住连接到其端口的设备的MAC地址，并根据目标MAC地址将数据包定向转发。交换机能够实现分组交换，提供更高的数据转发速率和网络带宽利用率。
        - 三层交换机：**工作在网络层，三层交换机使用了三层交换技术，即二层交换技术＋三层转发技术**。它解决了局域网中网段划分之后，网段中子网必须依赖路由器进行管理的局面，解决了传统路由器低速、复杂所造成的网络瓶颈问题。
        - 路由器：工作在网络层，使用IP地址进行数据包的转发和路由选择。路由器是一种能够连接多个网络并进行数据路由的设备。它通过分析网络层（IP层）的目标IP地址，根据路由表决定将数据包转发到哪个网络接口，以实现不同网络之间的数据交换和路由选择。
    - 分类
        - 以太网
            - IEEE 802.3以太网规约
                - 以太网媒介
                    - ![](0d43c287-2fe5-4cf1-9c6c-c9732ea9e2d5_1.webp)
                - 以太网帧格式
                    - 该帧包含6个域：前导码（preamble）包含8个字节（octet）；目的地址（DA）包含6个字节；源地址（SA）包含6个字节；类型域包含2个字节；数据域包含46-1500字节；帧效验序列（FCS）包含4个字节
            - CSMA/CD
        - 无线局域网
            - 概念和应用
                - 指采用无线通信技术的局域网
                - 移动接入、便携设备联网
            - IEEE 802.11体系结构：是一个**有固定基础设施的无线局域网**的国际标准
                - 基本概念（Station，AP，BSS，ESS，DS）
                    - 使用星型拓扑，其中心为接入点AP
                    - 最小构件是基本服务集BSS，包括：
                        - 一个基站Station
                        - 若干个移动站
                    - 所有的站在本BSS以内都可以直接通信，但在和本BSS以外的站通信时必须通过本BSS的基站
                    - 基础结构网路拓展ESS：多个BSS组成的多区网，一个孤立的BSS通过接入点AP链接到一个分配系统DS，然后再连接另一个BSS构成ESS
                - 体系结构图
                    - ![](3e2842a2-8187-46fd-a83c-700b8d53d40d_1.png)
            - CSMA/CA
                - 分布式协调功能（DCF）
                    - 在DCF方式下，没有中心控制站点，每个站点使用CSMA/CA协议通争用信道来获取发送权，这是802.11定义的默认方式
                - 点协调功能（PCF）
                    - PCF方式使用集中控制的接入算法（一般在接入点AP实现集中控制），是802.11定义的可选方式，在实际中较少使用
            - 802.11 b/g频段及传输速率
                - ![](103f37bffa534d65aff5978dbf777d4d_1.jpg)
                - ![](bed5ed124aac4898b3ca42ac053bb536_1.jpg)
    - 冲突域和广播域
        - 冲突域（基于第一层物理层）
            - 在以太网中，如果某个CSMA/CD网络上的两台计算机在同时通信时会发生冲突，那么这个CSMA/CD网络就是一个冲突域（collision domain)
            - 如果以太网中各个网段以**集线器Hub连接**，因为不能避免冲突，所以它们仍然是**一个冲突域**
            - 第二层设备能隔离冲突域，比如二层交换机。交换机（路由器也能）能缩小冲突域的范围，**交换接的每一个端口就是一个冲突域**
        - 广播域（基于第二层数据链路层）
            - 广播是一种信息的传播方式，指网络中的某一设备同时向网络中所有的其它设备发送数据，这个数据所能广播到的范围即为广播域(Broadcast Domain) 
            - 第三层设备才能隔离广播域，比如路由器 Router。路由器能隔离广播域，其每一个端口就是一个广播域。（或者划分vlan也可以隔离），还可以隔离二层广播风暴
    - *虚拟局域网（实验） VLAN（Virtual LAN）*
        - VLAN即虚拟局域网，是将一个物理的LAN在逻辑上划分为多个广播域的通信技术，VLAN内的主机间可以直接通信，而VLAN间不能直接通信，从而将广播报文限制在一个VLAN内
        - 优点和目的
            - 1.划分广播域
                - 减少垃圾数据
            - 2.增强局域网的安全性
            - 3.提高健壮性
            - 4.灵活构建工作组
        - 划分VLAN的方式
            - *基于端口*
                - 给交换机的每个接口配置不同的PVID，当一个数据帧进入交换机接口时，如果没有带VLAN标签且该接口上配置了PVID，那么该数据帧就会被打上接口的PVID。如果进入的帧已经带有VLAN标签，那么不会再增加VLAN标签，即使端口已经配置了PVID（不覆盖）
                    - *Access*
                        - 只允许通过一个VLAN
                    - *Trunk*
                        - 允许通过多个VLAN
                    - hybrid
            - 基于子网
                - 配置好子网域VLAN映射表，如果交换设备收到的是untagged（不带VLAN标签）帧，交换设备根据报文中的源IP地址信息，确认添加的VLAN ID。将指定网段或IP地址发出的报文在指定的VLAN中传输，**减轻了网络管理着的任务量，且有利于管理**
            - 基于MAC地址
                - 先配置好MAC地址和VLAN映射关系表，当终端用户的物理位置发生改变，不需要重新配置VLAN。**提高了终端用户的安全性和接入的灵活性**
            - 基于协议
                - 将网络中提供的服务类型域VLAN相绑定，方便管理和维护。需要对网络中所有的协议类型和VLAN ID 的映射关系表进行初始配置。需要分析各种协议的地址格式并进行相应的转换，消耗交换机较多的资源，速度上稍具劣势
            - 基于匹配策略
                - 先在交换机上配置好终端的MAC地址和IP地址，并与VLAN 并联。只有符合条件的终端才能加入指定VLAN。符合策略的终端加入指定VLAN后，严禁修改IP地址和MAC地址，否则会导致终端从指定VLAN中退出



- 网络传输媒介利用率分析
    - U = 帧传输时间/帧的总时间（第一个bit发出最后一个bit收到）
        - PPP：U=1/1+a; a是一个bit从点到另一个点的时间
        - 令牌环：U=T1/（T1+T2）; T1是平均传送一个帧的时间，设为1，T2是发送令牌环的时间（**最后一个bit发送，令牌环释放，去往目的站点**）
            - case1:a\<1(帧比环长)则T2 = a/N(N是站点个数)
            - case2:a\>1(帧比环短)则T2 = a-1 + a/N
        - ALOHA：假设所有帧一样长
            - A=NxP（结点在t0发送数据）xP（没有别人在[t0-1,t0]发送）xP（没有别人在[t0,t0+1]发送）=Nxpx(1-p)^Nx(1-p)^N-1
            - U约等于A，取极限=1/2e 此时p=1/2N
        - Slotted ALOHA：
            - 某节点在某一时隙成功的概率：自己成功且其他节点都不成功
            - 任意结点在某一时隙成功的概率A：上面的值xN（站点个数）
            - A的最大值（求导）：得到p=1/N（p是站点在每个时隙发送的概率）时，A最大...
            - U约等于e^-1
        - CSMA/CD（p-resist）：p是检测到空闲后以p概率传输
            - A = Np(1-p)^N-1
            - 前j次失败，第j+1次成功的概率是：A(1-A)^j，j可以是1，2，...无穷，算得**次数j的期望值**：1-A/A
            - U=帧传输时间（默认为1）/帧传输时间+bit传播时间+平均竞争时间=1/1+a+2a`*`(（1-A）/A)=1/1+(2-A)a/A
            - N无穷，U约等于1/(2e-1)a=1/1+4.44a
    - **CSMA/CD**
        - 即载波侦听多路访问/冲突检测，是广播型信道中采用一种随机访问技术的竞争型访问方法，具有多目标地址的特点
            - 总线型网络广播信道传输数据，防止冲突的技术
        - 四大要点
            - 1.先听再发
            - 2.边听边发
            - 3.冲突停止
            - 4.延迟后发
    - **PPP（Point to Point Protocol）**
        - 点对点通信是一对一信道，因此不会发生碰撞，比较简单，采用PPP协议
            - 单播
        - PPP协议就是用户计算机和ISP（互联网服务提供商）进行通信时使用的数据链路层的协议
        - PPP最初设计是为了两个对等结点之间的IP流量传输提供一种**封装协议**
        - 封装数据帧
    - *CRC*
        - 循环冗余校验

